<?xml version="1.0" encoding="utf-8" ?>

<Patch>
	
	<!-- ID: 2881513314 -->
	<Operation Class="PatchOperationFindMod">
		<mods><li>Biotech Nyaron</li></mods>
		
		<match Class="PatchOperationFindMod">
			<mods><li>Biotech</li></mods>
			<match Class="PatchOperationSequence">
				<operations>
					
					<li Class="PatchOperationAdd">
						<xpath>/Defs/XenotypeDef[defName="Nyaron"]/genes</xpath>
						<value>
							<li>Libido_High</li>
							<li>DarkVision</li>
							<li>AptitudeTerrible_Artistic</li>
							<li>AptitudeTerrible_Animals</li>
						</value>
					</li>
					
					<li Class="PatchOperationReplace">
						<xpath>/Defs/GeneDef[defName="Nyaron"]/biostatMet</xpath>
						<value>
							<biostatMet>6</biostatMet>
						</value>
					</li>
					
					<li Class="PatchOperationRemove">
						<xpath>/Defs/XenotypeDef[defName="Nyaron"]/genes/li[text()="VerySleepy" or text()="Hair_SnowWhite" or text()="Hair_InkBlack" or text()="Hair_Gray" or text()="Hair_DarkBlack" or text()="Hair_MidBlack" or text()="Hair_DarkReddish" or text()="Hair_DarkSaturatedReddish" or text()="Hair_DarkBrown" or text()="Hair_ReddishBrown" or text()="Hair_SandyBlonde" or text()="Hair_Blonde" or text()="Hair_Pink" or text()="Hair_LightPurple" or text()="Hair_LightBlue" or text()="Hair_LightTeal" or text()="Hair_LightGreen" or text()="Hair_LightOrange" or text()="Hair_BrightRed" or text()="Beauty_Pretty"]</xpath>
					</li>
					
					<li Class="PatchOperationRemove">
						<xpath>/Defs/FactionDef[defName="OutlanderNyaron"]</xpath>
					</li>
					
					<li Class="PatchOperationAdd">
						<xpath>/Defs/FactionDef[@Name="OutlanderFactionBase" or defName="Pirate"]/xenotypeSet/xenotypeChances</xpath>
						<value>
							<Nyaron MayRequire="Ludeon.RimWorld.Biotech">0.35</Nyaron>
						</value>
					</li>
					
					<li Class="PatchOperationAdd">
						<xpath>/Defs/FactionDef[defName="PirateWaster"]/xenotypeSet/xenotypeChances</xpath>
						<value>
							<Nyaron MayRequire="Ludeon.RimWorld.Biotech">0.35</Nyaron>
						</value>
					</li>
					
				</operations>
			</match>
		</match>
	</Operation>
	
	
	<!-- ID: 2881513314 -->
	<Operation Class="PatchOperationFindMod">
		<mods><li>Biotech Nyaron</li></mods>
		
		<match Class="PatchOperationFindMod">
			<mods><li>Biotech</li></mods>
			
			<match Class="PatchOperationFindMod">
				<mods><li>Nyaron race</li></mods>
				
				<match Class="PatchOperationSequence">
					<operations>
						<li Class="PatchOperationAdd">
							<xpath>/Defs/PawnKindDef[@Name="NyaronBase"]/xenotypeSet/xenotypeChances</xpath>
							<value>
								<Nyaron MayRequire="Ludeon.RimWorld.Biotech">1.0</Nyaron>
							</value>
						</li>
						<li Class="PatchOperationRemove">
							<xpath>/Defs/PawnKindDef[@Name="NyaronBase"]/xenotypeSet/xenotypeChances/Baseliner</xpath>
						</li>
						<li Class="PatchOperationRemove">
							<xpath>/Defs/GeneDef[defName="Nyaron"]/forcedHeadTypes</xpath>
						</li>
						<li Class="PatchOperationRemove">
							<xpath>/Defs/FactionDef[@Name="OutlanderFactionBase" or defName="Pirate" or defName="PirateWaster"]/xenotypeSet/xenotypeChances/Nyaron</xpath>
						</li>
						<li Class="PatchOperationRemove">
							<xpath>/Defs/XenotypeDef[defName="Nyaron"]/genes/li[text()="Ears_Nyaron_Normal" or text()="Tail_Nyaron_Normal" or text()="PsychicAbility_Dull"]</xpath>
						</li>
						<li Class="PatchOperationAdd">
							<xpath>/Defs/XenotypeDef[defName="Nyaron"]/genes</xpath>
							<value>
								<li>Beauty_Pretty</li>
							</value>
						</li>
					</operations>
				</match>
			</match>
		</match>
	</Operation>
	
	
	<!-- ID: 1854376306 -->
	<Operation Class="PatchOperationFindMod">
		<mods><li>Nyaron race</li></mods>
		
		<!-- ID: 2723801948 -->
		<match Class="PatchOperationFindMod">
			<mods><li>Vanilla Factions Expanded - Pirates</li></mods>
			
			<match Class="PatchOperationSequence">
				<operations>
					
					<!-- Normal fights, weak mix -->
					<li Class="PatchOperationAdd">
						<xpath>/Defs/FactionDef[defName="VFEP_Junkers" or defName="VFEP_Mercenaries"]/pawnGroupMakers/li/options</xpath>
						<value>
							<Nyaron_Soldier_Elite>2</Nyaron_Soldier_Elite>
							<Nyaron_Ranger_Elite>2</Nyaron_Ranger_Elite>
						</value>
					</li>
					
				</operations>
			</match>
		</match>
	</Operation>
	
	
	<!-- ID: 2881513314
	<Operation Class="PatchOperationFindMod">
		<mods><li>Biotech Nyaron</li></mods>
		
		<match Class="PatchOperationFindMod">
			<mods><li>Royalty</li></mods>
			
			<match Class="PatchOperationSequence">
				<operations>
					
					<li Class="PatchOperationAdd">
						<xpath>/Defs/FactionDef[defName="Empire"]/xenotypeSet/xenotypeChances</xpath>
						<value>
							<Nyaron MayRequire="Ludeon.RimWorld.Biotech">0.35</Nyaron>
						</value>
					</li>
					
				</operations>
			</match>
			
		</match>
	</Operation>-->
	
	
	<!-- ID: 1854376306 -->
	<Operation Class="PatchOperationFindMod">
		<mods><li>Nyaron race</li></mods>
		<match Class="PatchOperationSequence">
			<operations>
				
				<!-- Fix Names -->
				<li Class="PatchOperationReplace">
					<xpath>/Defs/RulePackDef[defName="NamerNyaronUtility"]/rulePack/rulesFiles</xpath>
					<value>
						<rulesFiles>
							<li>NameNyaronMaleNames->Names/Animal_Male</li>
							<li>NameNyaronFemaleNames->Names/Animal_Female</li>
							<li>NameNyaronLastNames->Names/Nyaron_LastNames</li>
						</rulesFiles>
					</value>
				</li>
				
				<li Class="PatchOperationReplace">
					<xpath>/Defs/RulePackDef[defName="NamerNyaronMale"]</xpath>
					<value>
						<RulePackDef>
							<defName>NamerNyaronMale</defName>
							<include>
							  <li>NamerNyaronUtility</li>
							</include>
							<rulePack>
							  <rulesStrings>
								<li>r_name(p=6)->[NameNyaronMaleNames] [NameNyaronLastNames]</li>
							  </rulesStrings>
							</rulePack>
						</RulePackDef>
					</value>
				</li>
				
				<li Class="PatchOperationReplace">
					<xpath>/Defs/RulePackDef[defName="NamerNyaronFemale"]</xpath>
					<value>
						<RulePackDef>
							<defName>NamerNyaronFemale</defName>
							 <include>
							  <li>NamerNyaronUtility</li>
							</include>
							<rulePack>
							  <rulesStrings>
							    <li>r_name(p=6)->[NameNyaronFemaleNames] [NameNyaronLastNames]</li>
							  </rulesStrings>
							</rulePack>
						</RulePackDef>
					</value>
				</li>
				
				
				<!--
					Fix Gender
					https://www.loverslab.com/topic/121825-mod-rimworld-gender-balancer/
				-->
				<li Class="PatchOperationReplace">
					<xpath>/Defs/AlienRace.ThingDef_AlienRace[defName="Alien_Nyaron"]/alienRace/generalSettings/maleGenderProbability</xpath>
					<value>
						<maleGenderProbability>0.5</maleGenderProbability>
					</value>
				</li>
				
				<!-- Add Hair -->
				<li Class="PatchOperationReplace">
					<xpath>/Defs/HeadTypeDef[@Name="NyaronHeadtypeBase"]/gender</xpath>
					<value>
						<gender>None</gender>
					</value>
				</li>
				<li Class="PatchOperationReplace">
					<xpath>/Defs/HairDef[defName="Nr_Long" or defName="Nr_Short" or defName="Nr_Twin" or defName="Nr_Twintw" or defName="Nr_ShortTwin" or defName="Nr_Pony"]/styleGender</xpath>
					<value>
						<styleGender>Any</styleGender>
					</value>
				</li>
				
				<!-- Trade -->
				<li Class="PatchOperationAdd">
					<xpath>/Defs/ThingDef[defName="Nr_PowerArmor" or defName="Nr_PowerArmorHelmet"]</xpath>
					<value>
						<tradeTags>
							<li>HiTechArmor</li>
						</tradeTags>
					</value>
				</li>
				
				<!-- Make enemy Faction
				<li Class="PatchOperationAdd">
					<xpath>/Defs/FactionDef[defName="NyaronFaction"]</xpath>
					<value>
						<naturalEnemy>true</naturalEnemy>
					</value>
				</li>-->
				
				<!-- Remove Faction
				<li Class="PatchOperationRemove">
					<xpath>/Defs/FactionDef[defName="NyaronFactionEnemy"]</xpath>
				</li>-->
				
				<!-- Add Batteries research to default Scenario -->
				<li Class="PatchOperationAdd">
					<xpath>/Defs/ScenarioDef[defName="NyaronStart_butler" or defName="NyaronStart"]/scenario/parts</xpath>
					<value>
						<li Class="ScenPart_StartingResearch">
							<def>StartingResearch</def>
							<project>Batteries</project>
						</li>
						<li Class="ScenPart_ScatterThingsNearPlayerStart">
							<def>ScatterThingsNearPlayerStart</def>
							<thingDef>MedicineIndustrial</thingDef>
							<count>30</count>
							<allowRoofed>True</allowRoofed>
						</li>
					</value>
				</li>
				<li Class="PatchOperationReplace">
					<xpath>/Defs/ScenarioDef[defName="NyaronStart"]/scenario/parts/li[def="ConfigPage_ConfigureStartingPawns"]</xpath>
					<value>
						<li Class="ScenPart_ConfigPage_ConfigureStartingPawns">
							<def>ConfigPage_ConfigureStartingPawns</def>
							<pawnCount>3</pawnCount>
							<pawnChoiceCount>8</pawnChoiceCount>
						</li>
					</value>
				</li>
				
				
			</operations>
		</match>
	</Operation>
	
	
	<!-- ID: 1854376306 -->
	<Operation Class="PatchOperationFindMod">
		<mods><li>Nyaron race</li></mods>
		
		<match Class="PatchOperationSequence">
			<operations>
				
				<li Class="PatchOperationAdd">
					<xpath>/Defs/TraderKindDef[defName="Caravan_Nyaron_BulkGoods"]/stockGenerators</xpath>
					<value>
						<li Class="StockGenerator_Tag">
							<tradeTag>HiTechArmor</tradeTag>
							<thingDefCountRange>0~1</thingDefCountRange>
							<countRange>1</countRange>
						</li>
					</value>
				</li>
				<li Class="PatchOperationAdd">
					<xpath>/Defs/TraderKindDef[defName="Caravan_Nyaron_Exotic"]/stockGenerators</xpath>
					<value>
						<li Class="StockGenerator_Tag">
							<tradeTag>HiTechArmor</tradeTag>
							<thingDefCountRange>4~7</thingDefCountRange>
							<countRange>1~2</countRange>
						</li>
					</value>
				</li>
				<li Class="PatchOperationAdd">
					<xpath>/Defs/TraderKindDef[defName="Caravan_Nyaron_Exotic"]/stockGenerators</xpath>
					<value>
						<li Class="StockGenerator_SingleDef">
							<thingDef>Steel</thingDef>
							<countRange>50~120</countRange>
						</li>
					</value>
				</li>
				<li Class="PatchOperationAdd">
					<xpath>/Defs/TraderKindDef[defName="Caravan_Nyaron_Exotic"]/stockGenerators</xpath>
					<value>
						<li Class="StockGenerator_Category">
							<categoryDef>NeurotrainersSkill</categoryDef>
							<thingDefCountRange>0~1</thingDefCountRange>
							<countRange>1</countRange>
						</li>
					</value>
				</li>
				
			</operations>
		</match>
		
	</Operation>
	
	
	<!-- ID: 1854376306 -->
	<Operation Class="PatchOperationFindMod">
		<mods><li>Nyaron race</li></mods>
		
		<match Class="PatchOperationFindMod">
			<mods><li>Royalty</li></mods>
			<match Class="PatchOperationSequence">
				<operations>
					
					<!-- Add Prestige Tag -->
					<li Class="PatchOperationAdd">
						<xpath>/Defs/ThingDef[defName="Nr_PowerArmor" or defName="Nr_PowerArmorHelmet"]/apparel/tags</xpath>
						<value>
							<li>PrestigeCombatGear</li>
						</value>
					</li>
					
					<!-- Add PsychicAmplifier to Traders -->
					<li Class="PatchOperationAdd">
						<xpath>/Defs/TraderKindDef[defName="Caravan_Nyaron_Exotic"]/stockGenerators</xpath>
						<value>
							<li Class="StockGenerator_SingleDef">
								<thingDef>PsychicAmplifier</thingDef>
								<countRange>0~1</countRange>
							</li>
						</value>
					</li>
					
					<!-- Empire Trader -->
					<li Class="PatchOperationAdd">
						<xpath>/Defs/FactionDef[defName="Empire"]/pawnGroupMakers/li[1]/guards</xpath>
						<value>
							<Nyaron_Soldier_Elite>1</Nyaron_Soldier_Elite>
							<Nyaron_Ranger_Elite>1</Nyaron_Ranger_Elite>
						</value>
					</li>
					
					<!-- Empire Combat 100 Normal fights -->
					<li Class="PatchOperationAdd">
						<xpath>/Defs/FactionDef[defName="Empire"]/pawnGroupMakers/li[2]/options</xpath>
						<value>
							<Nyaron_Soldier_Elite>3</Nyaron_Soldier_Elite>
							<Nyaron_Ranger_Elite>3</Nyaron_Ranger_Elite>
						</value>
					</li>
					
					<!-- Empire Combat 10 breach fights -->
					<li Class="PatchOperationAdd">
						<xpath>/Defs/FactionDef[defName="Empire"]/pawnGroupMakers/li[3]/options</xpath>
						<value>
							<Nyaron_Soldier_Elite>3</Nyaron_Soldier_Elite>
							<Nyaron_Ranger_Elite>3</Nyaron_Ranger_Elite>
						</value>
					</li>
					
					<!-- Empire Settlement -->
					<li Class="PatchOperationAdd">
						<xpath>/Defs/FactionDef[defName="Empire"]/pawnGroupMakers/li[4]/options</xpath>
						<value>
							<Nyaron_Soldier_Elite>2</Nyaron_Soldier_Elite>
							<Nyaron_Ranger_Elite>2</Nyaron_Ranger_Elite>
						</value>
					</li>
					
				</operations>
			</match>
		</match>
		
	</Operation>
	
	
	<!-- Adds Nyaron to other factions -->
	<Operation Class="PatchOperationFindMod">
		<mods><li>Nyaron race</li></mods>
		<match Class="PatchOperationSequence">
			<operations>
				
				<!-- Outlander Combat -->
				<li Class="PatchOperationAdd">
		            <xpath>/Defs/FactionDef[@Name="OutlanderFactionBase"]/pawnGroupMakers/li[1]/options</xpath>
					<value>
						<Nyaron_Soldier>4</Nyaron_Soldier>
						<Nyaron_Ranger>4</Nyaron_Ranger>
						<Nyaron_Soldier_Light>5</Nyaron_Soldier_Light>
						<Nyaron_Ranger_Light>5</Nyaron_Ranger_Light>
					</value>
				</li>
				
				<!-- Outlander Peaceful -->
				<li Class="PatchOperationAdd">
		            <xpath>/Defs/FactionDef[@Name="OutlanderFactionBase"]/pawnGroupMakers/li[2]/options</xpath>
					<value>
						<Nyaron_Soldier>3</Nyaron_Soldier>
					</value>
				</li>
				
				<!-- Outlander Trader -->
				<li Class="PatchOperationAdd">
		            <xpath>/Defs/FactionDef[@Name="OutlanderFactionBase"]/pawnGroupMakers/li[3]/guards</xpath>
					<value>
						<Nyaron_Soldier>3</Nyaron_Soldier>
						<Nyaron_Ranger>2</Nyaron_Ranger>
					</value>
				</li>
				
				<!-- Outlander Settlement -->
				<li Class="PatchOperationAdd">
		            <xpath>/Defs/FactionDef[@Name="OutlanderFactionBase"]/pawnGroupMakers/li[4]/options</xpath>
					<value>
						<Nyaron_Soldier>4</Nyaron_Soldier>
						<Nyaron_Ranger>4</Nyaron_Ranger>
						<Nyaron_Soldier_Light>5</Nyaron_Soldier_Light>
						<Nyaron_Ranger_Light>5</Nyaron_Ranger_Light>
					</value>
				</li>
				
				<!-- Pirate Combat 100, Normal fights, ranged with melee mix-ins -->
				<li Class="PatchOperationAdd">
		            <xpath>/Defs/FactionDef[@Name="PirateBandBase"]/pawnGroupMakers/li[1]/options</xpath>
					<value>
						<Nyaron_Soldier>3</Nyaron_Soldier>
						<Nyaron_Ranger>3</Nyaron_Ranger>
						<Nyaron_Soldier_Light>4</Nyaron_Soldier_Light>
						<Nyaron_Ranger_Light>4</Nyaron_Ranger_Light>
						<Nyaron_Ranger_Rocketeer>1</Nyaron_Ranger_Rocketeer>
					</value>
				</li>
				
				<!-- Pirate Combat 30, Normal fights, melee-only -->
				<li Class="PatchOperationAdd">
		            <xpath>/Defs/FactionDef[@Name="PirateBandBase"]/pawnGroupMakers/li[2]/options</xpath>
					<value>
						<Nyaron_Soldier>3</Nyaron_Soldier>
						<Nyaron_Soldier_Light>4</Nyaron_Soldier_Light>
					</value>
				</li>
				
				<!-- Pirate Combat 20, ranged only -->
				<li Class="PatchOperationAdd">
		            <xpath>/Defs/FactionDef[@Name="PirateBandBase"]/pawnGroupMakers/li[3]/options</xpath>
					<value>
						<Nyaron_Ranger>3</Nyaron_Ranger>
						<Nyaron_Ranger_Light>4</Nyaron_Ranger_Light>
					</value>
				</li>
				
				<!-- Pirate Combat 15, explosives with ranged mix-ins -->
				<li Class="PatchOperationAdd">
		            <xpath>/Defs/FactionDef[@Name="PirateBandBase"]/pawnGroupMakers/li[4]/options</xpath>
					<value>
						<Nyaron_Ranger>2</Nyaron_Ranger>
						<Nyaron_Ranger_Light>3</Nyaron_Ranger_Light>
						<Nyaron_Ranger_Rocketeer>1</Nyaron_Ranger_Rocketeer>
					</value>
				</li>
				
				<!-- Pirate Combat 10, snipers only -->
				<li Class="PatchOperationAdd">
		            <xpath>/Defs/FactionDef[@Name="PirateBandBase"]/pawnGroupMakers/li[5]/options</xpath>
					<value>
						<Nyaron_Ranger>2</Nyaron_Ranger>
						<Nyaron_Ranger_Light>3</Nyaron_Ranger_Light>
					</value>
				</li>
				
				<!-- Pirate Combat 2.5 Normal fights, drifters only 
				<li Class="PatchOperationAdd">
		            <xpath>/Defs/FactionDef[@Name="PirateBandBase"]/pawnGroupMakers/li[6]/options</xpath>
					<value>
					</value>
				</li>
				-->
				
				<!-- Pirate Settlement -->
				<li Class="PatchOperationAdd">
		            <xpath>/Defs/FactionDef[@Name="PirateBandBase"]/pawnGroupMakers/li[7]/options</xpath>
					<value>
						<Nyaron_Soldier>3</Nyaron_Soldier>
						<Nyaron_Ranger>3</Nyaron_Ranger>
						<Nyaron_Soldier_Light>4</Nyaron_Soldier_Light>
						<Nyaron_Ranger_Light>4</Nyaron_Ranger_Light>
					</value>
				</li>
				
			</operations>
		</match>
	</Operation>
	
	
	<!-- ID: 1854376306 -->
	<Operation Class="PatchOperationFindMod">
		<mods><li>Nyaron race</li></mods>
		
		<!-- ID: 2585928816 (Eccentric Tech - Angel Apparel) -->
		<match Class="PatchOperationFindMod">
			<mods><li>Eccentric Tech - Angel Apparel</li></mods>
			<match Class="PatchOperationSequence">
				<operations>
					
					<li Class="PatchOperationAdd">
						<xpath>/Defs/TraderKindDef[defName="Caravan_Nyaron_CombatSupplier" or defName="Caravan_Nyaron_Exotic"]/stockGenerators</xpath>
						<value>
							<li Class="StockGenerator_Category">
								<categoryDef>EccentricApparel</categoryDef>
								<thingDefCountRange>1~2</thingDefCountRange>
								<countRange>1~2</countRange>
							</li>
							<li Class="StockGenerator_Category">
								<categoryDef>EccentricApparelHeadwear</categoryDef>
								<thingDefCountRange>1~2</thingDefCountRange>
								<countRange>1~2</countRange>
							</li>
							<li Class="StockGenerator_Category">
								<categoryDef>EccentricApparelGear</categoryDef>
								<thingDefCountRange>1~2</thingDefCountRange>
								<countRange>1~2</countRange>
							</li>
						</value>
					</li>
					
				</operations>
			</match>
		</match>
		
	</Operation>
	
	
	<!-- ID: 2155485488 -->
	<Operation Class="PatchOperationFindMod">
		<mods><li>Nyaron race</li></mods>
		
		<!-- ID: 2585928816 (Eccentric Tech - Angel Apparel) -->
		<match Class="PatchOperationFindMod">
			<mods><li>Cybernetic Warfare and Special Weapons (Continued)</li></mods>
			<match Class="PatchOperationSequence">
				<operations>
					
					<li Class="PatchOperationAdd">
						<xpath>/Defs/TraderKindDef[defName="Caravan_Nyaron_CombatSupplier" or defName="Caravan_Nyaron_Exotic"]/stockGenerators</xpath>
						<value>
							<li Class="StockGenerator_Category">
								<categoryDef>CW_CyborgWeaponry</categoryDef>
								<thingDefCountRange>1~3</thingDefCountRange>
								<countRange>2~3</countRange>
							</li>
						</value>
					</li>
					
				</operations>
			</match>
		</match>
		
	</Operation>
	
</Patch>